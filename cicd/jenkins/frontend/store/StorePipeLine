 pipeline {
     agent any
     environment {
         //Docker Hub 아이디와 비밀번호 설정
         dockerhubid = ''
         dockerhubpw = ''
     }
     stages {
         stage('git clone') {
             steps {
                 // GitHub 저장소에서 코드를 클론합니다.
                 git branch: 'develop', url: 'https://github.com/beyond-sw-camp/be02-fin-Surisuri_Masuri-OMS'
             }
         }
         stage('Install Dependencies') {
             steps {
                 script {
                     dir('frontend/store/') { // 디렉토리 변경
                         sh 'pwd'
                         sh 'ls -al'
                         sh 'rm -rf dist/'
                         sh 'npm install'
                     }
                 }
             }
         }
         stage('Build') {
             steps {
                 dir('frontend/store/') { // 디렉토리 변경
                     sh 'pwd'
                     sh 'npm run build'
                 }
             }
         }
         stage('Docker Build') {
             steps {
                 dir('frontend/store/') { // 디렉토리 변경
                     sh 'pwd'
                     sh 'docker build -t beomiya/final_store_frontend:1.${BUILD_ID} .' // 변경된 명령어
                 }
             }
         }
         stage('Docker Push') {
             steps {
                 // Docker 이미지를 Docker Hub에 푸시
                 sh "docker login -u $dockerhubid -p $dockerhubpw"
                 sh "docker push beomiya/final_store_frontend:1.${BUILD_ID}"
             }
         }
         stage('SSH Transfer and Kubernetes Deployment') {
             steps {
                 sshPublisher(
                     continueOnError: false,
                     failOnError: true,
                     publishers: [
                         sshPublisherDesc(
                             configName: 'K8S',
                             verbose: true,
                             transfers: [
                                 sshTransfer(
                                     sourceFiles: 'frontendstore-deployment.yml',
                                     remoteDirectory: '/root/',
                                     execCommand: 'sed -i "s/VERSION/$BUILD_NUMBER/g" /root/frontendstore-deployment.yml'
                                 ),
                                 sshTransfer(
                                     execCommand: 'kubectl apply -f /root/frontendstore-deployment.yml'
                                 )
                             ]
                         )
                     ]
                 )
             }
         }
     }
 }